<!-- Bookings Page - Tailwind UI -->

<!-- Page Header -->
<div class="flex items-center justify-between mb-6">
    <div>
        <h1 class="text-2xl font-bold text-stone-900">Quản lý đặt bàn</h1>
        <p class="text-stone-500">Xem và quản lý tất cả booking của nhà hàng</p>
    </div>
    <span class="px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm font-medium">
        {{total}} booking
    </span>
</div>

<!-- Filters -->
<div class="card p-4 mb-6">
    <form id="bookingFilterForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4">
        <div class="form-group mb-0">
            <label for="fromDate" class="form-label">Từ ngày</label>
            <input type="date" class="form-input" id="fromDate" name="from_date">
        </div>
        <div class="form-group mb-0">
            <label for="toDate" class="form-label">Đến ngày</label>
            <input type="date" class="form-input" id="toDate" name="to_date">
        </div>
        <div class="form-group mb-0">
            <label for="statusFilter" class="form-label">Trạng thái</label>
            <select class="form-input form-select" id="statusFilter" name="status">
                <option value="">Tất cả</option>
                <option value="PENDING">Chờ xác nhận</option>
                <option value="CONFIRMED">Đã xác nhận</option>
                <option value="CANCELLED">Đã huỷ</option>
                <option value="CHECKED_IN">Đã check-in</option>
                <option value="NO_SHOW">Không đến</option>
            </select>
        </div>
        <div class="form-group mb-0 lg:col-span-2">
            <label for="q" class="form-label">Tìm kiếm</label>
            <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-stone-400"></i>
                <input type="text" class="form-input pl-9" id="q" name="q" 
                       placeholder="Tên khách / SĐT / Mã booking">
            </div>
        </div>
        <div class="form-group mb-0">
            <label class="form-label">&nbsp;</label>
            <div class="flex gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="fa-solid fa-filter"></i>
                    Lọc
                </button>
                <button type="reset" class="btn btn-secondary">
                    <i class="fa-solid fa-rotate-left"></i>
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Bookings Table -->
<div class="card">
    <div class="flex items-center justify-between p-4 border-b border-stone-100">
        <h3 class="font-semibold text-stone-900 flex items-center gap-2">
            <i class="fa-solid fa-calendar-check"></i>
            Danh sách đặt bàn
        </h3>
    </div>
    
    <div class="overflow-x-auto">
        <table class="data-table">
            <thead>
                <tr>
                    <th class="text-center">Mã</th>
                    <th>Khách hàng</th>
                    <th>Số người</th>
                    <th>Thời gian</th>
                    <th class="text-center">Bàn</th>
                    <th class="text-center">Trạng thái</th>
                    <th class="text-center">Cọc</th>
                    <th class="text-right">Thao tác</th>
                </tr>
            </thead>
            <tbody>
                {{#each data}}
                <tr class="animate-fade-in" style="animation-delay: {{@index}}0ms">
                    <td class="text-center">
                        <code class="bg-stone-100 px-2 py-1 rounded text-sm font-mono font-bold">{{code}}</code>
                    </td>
                    <td>
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center text-primary-700 font-semibold">
                                {{substring customerName 0 1}}
                            </div>
                            <div>
                                <p class="font-medium text-stone-900">{{customerName}}</p>
                                <p class="text-sm text-stone-500">{{customerPhone}}</p>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="flex items-center gap-1">
                            <i class="fa-solid fa-users"></i>
                            {{guests}}
                        </span>
                    </td>
                    <td>
                        <p class="font-bold text-stone-900">{{formatTime datetime}}</p>
                        <p class="text-sm text-stone-500">{{formatDate datetime}}</p>
                    </td>
                    <td class="text-center">
                        {{#if tableName}}
                        <span class="inline-flex items-center px-2.5 py-1 bg-stone-100 text-stone-700 rounded-lg text-sm font-bold">
                            {{tableName}}
                        </span>
                        {{else}}
                        <span class="text-stone-400">—</span>
                        {{/if}}
                    </td>
                    <td class="text-center">
                        {{#if (eq status 'PENDING')}}
                        <span class="badge badge-pending">Chờ xác nhận</span>
                        {{else if (eq status 'CONFIRMED')}}
                        <span class="badge badge-confirmed">Đã xác nhận</span>
                        {{else if (eq status 'CHECKED_IN')}}
                        <span class="badge badge-checked-in">Đã check-in</span>
                        {{else if (eq status 'CANCELLED')}}
                        <span class="badge badge-cancelled">Đã hủy</span>
                        {{else if (eq status 'NO_SHOW')}}
                        <span class="badge badge-no-show">Không đến</span>
                        {{else}}
                        <span class="badge badge-no-show">{{status}}</span>
                        {{/if}}
                    </td>
                    <td class="text-center">
                        {{#if deposit}}
                        <span class="font-medium text-green-600">{{formatCurrency deposit}}</span>
                        {{else}}
                        <span class="text-stone-400">—</span>
                        {{/if}}
                    </td>
                    <td class="text-right">
                        <div class="flex items-center justify-end gap-2">
                            {{#if (or (eq status 'PENDING') (eq status 'CONFIRMED'))}}
                            <button class="btn btn-sm btn-secondary text-stone-600 hover:bg-stone-200" 
                                    data-action="noShowBooking" data-id="{{id}}" title="Khách không đến">
                                <i class="fa-solid fa-user-slash"></i>
                                <span>Không đến</span>
                            </button>
                            {{/if}}

                            {{#if (eq status 'PENDING')}}
                            <button class="btn btn-sm btn-success" 
                                    data-action="confirmBooking" data-id="{{id}}">
                                <i class="fa-solid fa-check"></i>
                                <span>Xác nhận</span>
                            </button>
                            {{/if}}
                            
                            {{#if (eq status 'CONFIRMED')}}
                            <button class="btn btn-sm btn-primary" 
                                    data-action="checkInBooking" data-id="{{id}}">
                                <i class="fa-solid fa-circle-check"></i>
                                <span>Check-in</span>
                            </button>
                            {{/if}}
                            
                            {{#if (or (eq status 'PENDING') (eq status 'CONFIRMED'))}}
                            <button class="btn btn-sm btn-outline text-red-500 hover:bg-red-50" 
                                    data-action="cancelBooking" data-id="{{id}}">
                                <i class="fa-solid fa-xmark"></i>
                                <span>Huỷ</span>
                            </button>
                            {{/if}}
                        </div>
                    </td>
                </tr>
                {{else}}
                <tr>
                    <td colspan="8">
                        <div class="empty-state">
                            <i class="fa-solid fa-inbox"></i>
                            <p class="text-stone-500">Không có booking nào</p>
                        </div>
                    </td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
    
    <!-- Pagination -->
    <div class="flex items-center justify-between p-4 border-t border-stone-100">
        <div class="text-sm text-stone-500">
            Hiển thị <span class="font-medium">{{pagination.from}}</span> đến <span class="font-medium">{{pagination.to}}</span> trong tổng số <span class="font-medium">{{total}}</span> kết quả
        </div>
        <div class="flex gap-2">
            <button class="btn btn-sm btn-secondary" onclick="changePage({{subtract pagination.currentPage 1}})" {{#unless pagination.hasPrev}}disabled{{/unless}}>
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            <span class="px-3 py-1 bg-stone-100 rounded text-sm font-medium flex items-center">
                Trang {{pagination.currentPage}} / {{pagination.totalPages}}
            </span>
            <button class="btn btn-sm btn-secondary" onclick="changePage({{add pagination.currentPage 1}})" {{#unless pagination.hasNext}}disabled{{/unless}}>
                <i class="fa-solid fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<!-- Assign Table Modal -->
<div id="assignTableModal" class="hidden">
    <div class="modal-backdrop" onclick="closeModal('assignTableModal')"></div>
    <div class="modal">
        <div class="modal-header">
            <h5 class="modal-title">Gán bàn cho booking</h5>
            <button class="modal-close" onclick="closeModal('assignTableModal')">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="assignBookingId">
            <div class="form-group">
                <label for="selectTable" class="form-label">Chọn bàn</label>
                <select class="form-input form-select" id="selectTable">
                    <option value="">-- Chọn bàn --</option>
                    {{#each tables}}
                    <option value="{{id}}">{{name}} ({{capacity}} người) - {{area}}</option>
                    {{/each}}
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('assignTableModal')">Huỷ</button>
            <button class="btn btn-primary" id="confirmAssignTable">Xác nhận</button>
        </div>
    </div>
</div>



